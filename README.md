## Getting Started
1. `.env.local`を`api`直下に配置
1. `pnpm i --frozn-lockfile`
1. 以下で起動し
    ```shell
    npm run dev
    ```
1. [http://localhost:3088](http://localhost:3088)からボタン押したらPDFが開くはず
1. [http://localhost:8088/docs](http://localhost:8088/docs)から直接API叩きでPDFが落とせるはず

## 概要
`pdfme`によるテンプレートベースPDF生成の実装サンプル

apiV2のinternalな個別専用エンドポイントでキー情報からPDF生成を行い、生成したPDFのバイナリを画面までパイプするのが基本想定

> [!Note]
> 追記：アプリの関係上、署名付きURLのような認証情報なし専用トークンのみでPDFを表示する必要があるため、その実装は案件ないで必要そう。
ここのAPIと画面の実装そのままというわけには行かなそうなので見積もり時に確認して含むこと

フォント、テンプレートはコンテナイメージにバンドル、
印影データはGoogleDriveから都度取得を想定。

印影は画像フィールドに差し込む形を想定。

## 構成
L api : apiv2に実装する想定で作ったサンプル apiv2から持ってきて不要箇所削ったものがベース
L web : 画面呼び出しのサンプル用に初期構成のままのプロジェクト

## テンプレートの作成
[pdfmeのエディタ](https://pdfme.com/ja/template-design)サイトにてGUIから作成可能。

「DL Template」からJSON形式でエクスポートできるのでそれを`api/assets/pdfTemplates`に配置する。

> [!Note]
> エディタサイトはセルフホスト可能で、pdfmeのリポジトリにサイトのソースが丸ごと載ってるのに加え、自前で作ることもできる。 
> fontファイルや配置可能フィールドなどは、ジェネレータの実装として想定しているものに絞りたいので、[カスタムで作成](https://pdfme.com/ja/docs/getting-started#%E3%83%87%E3%82%B6%E3%82%A4%E3%83%8A%E3%83%BC)し、Pagesに置いておくのが良さそう。

## 補足
- Lobby画面から呼ぶ場合lobbyApiも経由するが、経由するだけであんまり関係ないので省略
- 印影画像をGoogleDriveから取得する処理周りは機密が絡むので本実装時は要注意。
  - ファイルID、認証情報はapp_propertyではなく新規の専用テーブルで管理する
  - テーブルに保管する値は暗号化し、キーはシークレットマネージャで管理する 
  - 平文の認証情報だけでなく、ファイルIDもログに出すのも基本はNG
- バンドルしてるテンプレートに対して実装がうまくPDF生成できる確認のUTは実装するべき